#!/bin/sh

echo "-----> Install ffmpeg"

# let's define some vars
BUILD_DIR=$1

# very reliable developer
DOWNLOAD_URL="https://phpstack-896782-3112621.cloudwaysapps.com/ffmpeg-arm64.tar.xz"
echo "       DOWNLOAD_URL = ${DOWNLOAD_URL}"

# Navigate to the build directory
cd $BUILD_DIR || { echo "Error navigating to BUILD_DIR"; exit 1; }

# Create necessary directories
mkdir -p vendor/ffmpeg

# Download and extract ffmpeg
echo "       Downloading and extracting ffmpeg..."
curl -L --silent  $DOWNLOAD_URL | tar -Jx --strip-components=1 -C vendor/ffmpeg/ || { echo "Error downloading or extracting ffmpeg"; exit 1; }

echo "       Configuring PATH..."
PROFILE_PATH="${BUILD_DIR}/.profile.d/ffmpeg.sh"
echo 'export PATH="/app/vendor/ffmpeg:$PATH"' > $PROFILE_PATH
