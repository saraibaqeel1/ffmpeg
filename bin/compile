#!/bin/sh

echo "-----> Install ffmpeg"

# let's define some vars
BUILD_DIR=$1

# very reliable developer
DOWNLOAD_URL="https://johnvansickle.com/ffmpeg/builds/ffmpeg-git-amd64-static.tar.xz"
echo "       DOWNLOAD_URL = ${DOWNLOAD_URL}"

# Navigate to the build directory
cd $BUILD_DIR || { echo "Error navigating to BUILD_DIR"; exit 1; }

# Create necessary directories
mkdir -p vendor/ffmpeg


# Download ffmpeg.zip
echo "       Downloading ffmpeg..."
curl -L --silent -o ffmpeg.zip $DOWNLOAD_URL 

# # Unzip ffmpeg
# echo "       Unzipping ffmpeg..."
# unzip -q ffmpeg.zip -d vendor/ffmpeg/ || { echo "Error unzipping ffmpeg"; exit 1; }

# Optionally remove the downloaded zip file to clean up space
rm ffmpeg.zip

echo "       Configuring PATH..."
PROFILE_PATH="${BUILD_DIR}/.profile.d/ffmpeg.sh"
mkdir -p "${BUILD_DIR}/.profile.d/"  # Ensure the directory exists
echo 'export PATH="/app/vendor/ffmpeg:$PATH"' > $PROFILE_PATH

